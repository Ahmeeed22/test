"use strict";(self.webpackChunkuser=self.webpackChunkuser||[]).push([[413],{9413:(rt,g,a)=>{a.r(g),a.d(g,{CustomerModule:()=>st});var m=a(6895),f=a(9299),r=a(4006),p=a(5938),_=a(5976),t=a(4650),b=a(3851),y=a(9298),v=a(7185),N=a(5076),x=a(4859),S=a(7392),h=a(9549),Z=a(4144),A=a(9241);const U=["status"];function D(e,n){if(1&e&&t._UZ(0,"app-ddl-searchable",18,19),2&e){const o=t.oxw();t.Q6J("objData",o.statusObj)}}function w(e,n){if(1&e){const o=t.EpF();t.TgZ(0,"button",20),t.NdJ("click",function(){t.CHM(o);const i=t.oxw();return t.KtG(i.createCustomer())}),t._uU(1,"Create"),t.qZA()}}function k(e,n){if(1&e){const o=t.EpF();t.TgZ(0,"button",20),t.NdJ("click",function(){t.CHM(o);const i=t.oxw();return t.KtG(i.updateCustomer())}),t._uU(1,"Update"),t.qZA()}}let C=(()=>{class e{constructor(o,s,i,l,u,d,nt,it,at){this._CustomersService=o,this.fb=s,this._AuthService=i,this._Router=l,this.toaster=u,this.dialog=d,this.dialogpublic=nt,this._TransactionsService=it,this.data=at,this.getStatus(),this.createForm()}ngOnInit(){this.gatheringData()}createForm(){this.newServiceForm=this.fb.group({name:[this.data?.name||"",r.kI.required],email:[this.data?.email||"",r.kI.pattern("^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$")],phoneNo:[this.data?.phoneNo||""],deposite:[this.data?.deposite||0,r.kI.min(0)]}),this.formValues={...this.newServiceForm.value}}getStatus(){this.statusObj={staticArray:[{id:1,name:" Active"},{id:0,name:"Dis active"}],placeholder:"\u0627\u0644\u062d\u0627\u0644\u0629 ",placeholderEn:"Status",required:!0,searachable:!1,multiSelect:!1,oldSelectedItems:this.data?this?.data?.active&&this.data?{id:1,name:" Active"}:{id:0,name:"Dis active"}:null}}gatheringData(){let o=this.status?.gettingResult()?.id,s=this._AuthService.currentUser.getValue();if(s){const{company_id:i,id:l}=s;return{...this.newServiceForm.value,active:o,company_id:i,admin_id:l}}this.toaster.error("you are not Authorized"),this._Router.navigate(["/login"])}createCustomer(){if(this._AuthService.currentUser.getValue())if(this.newServiceForm.valid&&this.status.validate()){let s=this.gatheringData()?this.gatheringData():null;this._CustomersService.addCustomer(s).subscribe({next:i=>{this.toaster.success("success add Service","success"),this.dialog.close(!0)}})}else this.newServiceForm.markAllAsTouched(),this.status.validate()}updateCustomer(){if(this.testChange()&&this.newServiceForm.valid){let o=this.gatheringData()?this.gatheringData():null;o.deposite?this._TransactionsService.getAllTransactions({customer_id:this.data.id,balanceDue:1}).subscribe({next:s=>{s.allProfite[0].balanceDue?this.toaster.warning(`failed update Customer because he have balance = ${s.allProfite[0].balanceDue} at ${s.result.count} transactions`,"success"):this._CustomersService.updateCustomer(this.data.id,o).subscribe({next:i=>{console.log(i),this.toaster.success("success update Customer","success"),this.dialog.close(!0)},error:i=>{console.log(i)}})}}):this._CustomersService.updateCustomer(this.data.id,o).subscribe({next:s=>{this.toaster.success("success update Customer","success"),this.dialog.close(!0)}})}else this.newServiceForm.markAllAsTouched(),this.status.validate(),this.toaster.info("No Data Edited","info")}close(){let o;this.testChange()?(o=this.dialogpublic.open(_.P,{width:"750px",disableClose:!0}),o?.afterClosed().subscribe(s=>{"no"!==s&&this.dialog.close()})):this.dialog.close()}testChange(){let o=!1;return Object.keys(this.formValues).forEach(s=>{this.formValues[s]!==this.newServiceForm.value[s]&&(o=!0)}),!o&&this?.data?.active!=this.status.gettingResult()?.id&&(o=!0),o}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(b.v),t.Y36(r.qu),t.Y36(y.e),t.Y36(f.F0),t.Y36(v._W),t.Y36(p.so),t.Y36(p.uw),t.Y36(N.v),t.Y36(p.WI))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-add-customer"]],viewQuery:function(o,s){if(1&o&&t.Gf(U,5),2&o){let i;t.iGM(i=t.CRH())&&(s.status=i.first)}},decls:37,vars:5,consts:[[1,"p-2"],[1,"d-flex","justify-content-between","align-items-center"],[1,"m-0"],["mat-flat-button","",1,"text-danger",3,"click"],[3,"formGroup"],[1,"row","mt-1"],[1,"col-md-12","my-2"],[3,"objData",4,"ngIf"],[1,"col-md-12"],["appearance","outline",1,"w-100","rounded",2,"border-radius","20px !important"],["matInput","","currencyMask","","type","text","formControlName","name","placeholder","Name"],["matInput","","currencyMask","","type","email","formControlName","email","placeholder","Email"],["matInput","","currencyMask","","type","number","formControlName","phoneNo","placeholder","phoneNo"],["matInput","","currencyMask","","type","number","formControlName","deposite","placeholder","Deposite"],[1,"tw-p-3"],[1,"d-flex","justify-content-center","align-items-center"],["mat-flat-button","","class","btn btn-success py-1 px-5 mx-2",3,"click",4,"ngIf"],["mat-flat-button","",1,"btn","btn-danger","py-1","px-5",3,"click"],[3,"objData"],["status",""],["mat-flat-button","",1,"btn","btn-success","py-1","px-5","mx-2",3,"click"]],template:function(o,s){1&o&&(t.TgZ(0,"div",0)(1,"header",1)(2,"h1",2),t._uU(3),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return s.close()}),t.TgZ(5,"mat-icon"),t._uU(6,"close"),t.qZA()()(),t.TgZ(7,"form",4)(8,"div",5)(9,"div",6),t.YNc(10,D,2,1,"app-ddl-searchable",7),t.qZA(),t.TgZ(11,"div",8)(12,"mat-form-field",9)(13,"mat-label"),t._uU(14,"Name"),t.qZA(),t._UZ(15,"input",10),t.qZA()(),t.TgZ(16,"div",8)(17,"mat-form-field",9)(18,"mat-label"),t._uU(19,"Email"),t.qZA(),t._UZ(20,"input",11),t.qZA()(),t.TgZ(21,"div",8)(22,"mat-form-field",9)(23,"mat-label"),t._uU(24,"phone No"),t.qZA(),t._UZ(25,"input",12),t.qZA()(),t.TgZ(26,"div",8)(27,"mat-form-field",9)(28,"mat-label"),t._uU(29,"Deposite"),t.qZA(),t._UZ(30,"input",13),t.qZA()()()(),t.TgZ(31,"footer",14)(32,"div",15),t.YNc(33,w,2,0,"button",16),t.YNc(34,k,2,0,"button",16),t.TgZ(35,"button",17),t.NdJ("click",function(){return s.close()}),t._uU(36,"Close"),t.qZA()()()()),2&o&&(t.xp6(3),t.Oqu(s.data?"Update Customer":"Add New Customer"),t.xp6(4),t.Q6J("formGroup",s.newServiceForm),t.xp6(3),t.Q6J("ngIf",s.statusObj),t.xp6(23),t.Q6J("ngIf",!s.data),t.xp6(1),t.Q6J("ngIf",s.data))},dependencies:[m.O5,x.lW,S.Hw,h.KE,h.hX,Z.Nt,r._Y,r.Fj,r.wV,r.JJ,r.JL,r.sg,r.u,A.g]}),e})();var T=a(7974),c=a(671);const L=["name"],M=["status"];function Y(e,n){if(1&e&&t._UZ(0,"app-ddl-searchable",38,39),2&e){const o=t.oxw();t.Q6J("objData",o.statusObj)}}function j(e,n){1&e&&(t.TgZ(0,"th",40),t._uU(1," Index "),t.qZA())}function J(e,n){if(1&e&&(t.TgZ(0,"td",41),t._uU(1),t.qZA()),2&e){const o=n.index;t.xp6(1),t.hij("",o+1," ")}}function O(e,n){1&e&&(t.TgZ(0,"th",40),t._uU(1," Name "),t.qZA())}function R(e,n){if(1&e&&(t.TgZ(0,"td",41),t._uU(1),t.qZA()),2&e){const o=n.$implicit;t.xp6(1),t.hij(" ",o.name," ")}}function q(e,n){1&e&&(t.TgZ(0,"th",40),t._uU(1," Email "),t.qZA())}function Q(e,n){if(1&e&&(t.TgZ(0,"td",41),t._uU(1),t.qZA()),2&e){const o=n.$implicit;t.xp6(1),t.hij(" ",o.email||"-"," ")}}function F(e,n){1&e&&(t.TgZ(0,"th",40),t._uU(1," Deposite "),t.qZA())}function I(e,n){if(1&e&&(t.TgZ(0,"td",41),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&e){const o=n.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,o.deposite," AED ")," ")}}function P(e,n){1&e&&(t.TgZ(0,"th",40),t._uU(1," Phone No "),t.qZA())}function G(e,n){if(1&e&&(t.TgZ(0,"td",41),t._uU(1),t.qZA()),2&e){const o=n.$implicit;t.xp6(1),t.hij(" ",o.phoneNo||"-"," ")}}function E(e,n){1&e&&(t.TgZ(0,"th",40),t._uU(1," Status "),t.qZA())}function H(e,n){if(1&e&&(t.TgZ(0,"td",41),t._UZ(1,"div",42),t.qZA()),2&e){const o=n.$implicit;t.xp6(1),t.Q6J("ngClass",o.active?"active":"disactive")}}function z(e,n){1&e&&(t.TgZ(0,"th",40),t._uU(1," Action "),t.qZA()),2&e&&t.uIk("rowspan",2)}function B(e,n){if(1&e){const o=t.EpF();t.TgZ(0,"td",43)(1,"button",44),t.NdJ("click",function(i){const u=t.CHM(o).$implicit,d=t.oxw();return t.KtG(d.updateCustomer(i,u))}),t._uU(2,"Update"),t.qZA(),t.TgZ(3,"button",45),t.NdJ("click",function(){const l=t.CHM(o).$implicit,u=t.oxw();return t.KtG(u.deleteCustomer(l.id))}),t._uU(4,"Delete"),t.qZA()()}}function $(e,n){1&e&&t._UZ(0,"tr",46)}function K(e,n){1&e&&t._UZ(0,"tr",47)}const W=function(){return[5,10,20]},V=[{path:"",redirectTo:"List",pathMatch:"full"},{path:"List",component:(()=>{class e{constructor(o,s,i){this._CustomersService=o,this.toaster=s,this.dialog=i,this.filteration={name:null,active:null},this.statusObj={staticArray:[{id:1,name:" Active"},{id:0,name:"Dis active"}],placeholder:"\u0627\u0644\u062d\u0627\u0644\u0629 ",placeholderEn:"Status",required:!1,searachable:!1,multiSelect:!1},this.displayedColumns=["index","name","email","phoneNo","deposite","active","action"],this.getAllCustomers()}getAllCustomers(o){this._CustomersService.getAllCustomersSearch(o).subscribe({next:s=>{this.dataSource=new c.by(s.result),this.dataSource.paginator=this.paginator,this.toaster.success("success get Customers","success"),console.log(s)}})}updateCustomer(o,s){this.dialog.open(C,{width:"60%",disableClose:!0,data:s}).afterClosed().subscribe(l=>{this.getAllCustomers()})}addCustomer(){this.dialog.open(C,{width:"60%",disableClose:!0}).afterClosed().subscribe(s=>{this.getAllCustomers()})}deleteCustomer(o){this.dialog.open(_.P,{width:"750px",disableClose:!0,data:{message:"Are You Sure to Delete ? "}}).afterClosed().subscribe(i=>{"no"!==i?this._CustomersService.deleteCustomer(o).subscribe({next:()=>{this.toaster.success("Customer Deleted Succesfully","Success"),this.getAllCustomers()}}):this.toaster.info("Customer not deleted","Info")})}search(o,s){(0==this.status.gettingResult()?.id||1==this.status.gettingResult()?.id)&&(this.filteration.active=this.status.gettingResult()?.id),s&&(this.filteration.name=s),this.getAllCustomers(this.filteration)}resetSearch(){this.filteration={},this.getAllCustomers(this.filteration),this.status.resetList(),this.name.nativeElement.value=null}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(b.v),t.Y36(v._W),t.Y36(p.uw))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-list-customer"]],viewQuery:function(o,s){if(1&o&&(t.Gf(L,5),t.Gf(M,5),t.Gf(T.NW,5)),2&o){let i;t.iGM(i=t.CRH())&&(s.name=i.first),t.iGM(i=t.CRH())&&(s.status=i.first),t.iGM(i=t.CRH())&&(s.paginator=i.first)}},decls:60,vars:6,consts:[[1,"m-4"],[1,"d-flex","justify-content-end","align-items-center","mx-auto","my-3"],["mat-raised-button","",1,"addService",2,"margin-right","14%",3,"click"],[1,"d-flex","justify-content-center","p-2","m-2"],[1,"border","p-2","m-2",2,"background-color","rgb(255, 254, 254)","border-radius","30px"],[1,"text-info","font-weight-bolder",2,"font-size","22px","padding-left","20px"],[1,"row","m-2"],[1,"col-md-4",2,"margin-top","12px"],[3,"objData",4,"ngIf"],[1,"col-md-4","my-2"],["appearance","outline",1,"w-100","rounded",2,"border-radius","20px !important"],["matInput","","currencyMask","","type","text","placeholder","Name"],["name",""],[1,"btns","d-flex","justify-content-end","align-items-end"],[1,"btn",2,"background","#1746A2",3,"click"],[1,"btn",2,"background-color","#ffb64d",3,"click"],[1,""],[1,"parennt","shadow","m-auto",2,"width","70%"],[1,"pt-2","mx-auto","d-flex","justify-content-end"],[1,"active"],[1,"px-2"],[1,"disactive"],[1,"table-responsive"],["mat-table","",1,"text-center",3,"dataSource"],["matColumnDef","index"],["class","text-center","mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","email"],["matColumnDef","deposite"],["matColumnDef","phoneNo"],["matColumnDef","active"],["matColumnDef","action"],["mat-cell","","class","action-link",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"d-flex","justify-content-center"],["showFirstLastButtons","","aria-label","Select page of periodic elements",3,"pageSizeOptions"],[3,"objData"],["status",""],["mat-header-cell","",1,"text-center"],["mat-cell",""],[1,"m-auto",3,"ngClass"],["mat-cell","",1,"action-link"],[1,"btn","btn-info","mx-2",3,"click"],[1,"btn","btn-danger","mx-2",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(o,s){if(1&o){const i=t.EpF();t.TgZ(0,"div",0)(1,"div",1)(2,"button",2),t.NdJ("click",function(){return s.addCustomer()}),t._uU(3,"Add Customer"),t.qZA()(),t.TgZ(4,"div",3)(5,"form",4)(6,"h3",5),t._uU(7,"Search"),t.qZA(),t.TgZ(8,"div",6)(9,"div",7),t.YNc(10,Y,2,1,"app-ddl-searchable",8),t.qZA(),t.TgZ(11,"div",9)(12,"mat-form-field",10)(13,"mat-label"),t._uU(14,"Name"),t.qZA(),t._UZ(15,"input",11,12),t.qZA()(),t.TgZ(17,"div",9)(18,"div",13)(19,"button",14),t.NdJ("click",function(u){t.CHM(i);const d=t.MAs(16);return t.KtG(s.search(u,d.value))}),t._uU(20,"Search"),t.qZA(),t.TgZ(21,"button",15),t.NdJ("click",function(){return s.resetSearch()}),t._uU(22,"Reset"),t.qZA()()()()()(),t.TgZ(23,"div",16)(24,"div",17)(25,"div",18),t._UZ(26,"div",19),t.TgZ(27,"span",20),t._uU(28,"Active"),t.qZA(),t._UZ(29,"div",21),t.TgZ(30,"span",20),t._uU(31,"dis Active"),t.qZA()(),t.TgZ(32,"div",22)(33,"table",23),t.ynx(34,24),t.YNc(35,j,2,0,"th",25),t.YNc(36,J,2,1,"td",26),t.BQk(),t.ynx(37,27),t.YNc(38,O,2,0,"th",25),t.YNc(39,R,2,1,"td",26),t.BQk(),t.ynx(40,28),t.YNc(41,q,2,0,"th",25),t.YNc(42,Q,2,1,"td",26),t.BQk(),t.ynx(43,29),t.YNc(44,F,2,0,"th",25),t.YNc(45,I,3,4,"td",26),t.BQk(),t.ynx(46,30),t.YNc(47,P,2,0,"th",25),t.YNc(48,G,2,1,"td",26),t.BQk(),t.ynx(49,31),t.YNc(50,E,2,0,"th",25),t.YNc(51,H,2,1,"td",26),t.BQk(),t.ynx(52,32),t.YNc(53,z,2,1,"th",25),t.YNc(54,B,5,0,"td",33),t.BQk(),t._uU(55,"> "),t.YNc(56,$,1,0,"tr",34),t.YNc(57,K,1,0,"tr",35),t.qZA()(),t.TgZ(58,"div",36),t._UZ(59,"mat-paginator",37),t.qZA()()()()}2&o&&(t.xp6(10),t.Q6J("ngIf",s.statusObj),t.xp6(23),t.Q6J("dataSource",s.dataSource),t.xp6(23),t.Q6J("matHeaderRowDef",s.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",s.displayedColumns),t.xp6(2),t.Q6J("pageSizeOptions",t.DdM(5,W)))},dependencies:[m.mk,m.O5,x.lW,h.KE,h.hX,Z.Nt,c.BZ,c.fO,c.as,c.w1,c.Dz,c.nj,c.ge,c.ev,c.XQ,c.Gk,T.NW,r._Y,r.JL,r.F,A.g,m.H9],styles:["button[_ngcontent-%COMP%]{color:#fff;margin:0 5px}button.addService[_ngcontent-%COMP%]{background-color:#63e38a!important;color:#fff;padding:2px 23px;font-size:20px}table[_ngcontent-%COMP%]{width:100%;margin:20px auto}[_nghost-%COMP%]     table thead{background-color:#7e807e!important}[_nghost-%COMP%]     table thead .mat-header-cell{color:#fff}button[_ngcontent-%COMP%]{transition:all .4s;border-radius:13px}button[_ngcontent-%COMP%]:hover{border-radius:30px}th[_ngcontent-%COMP%]{font-size:16px;font-weight:500}.active[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;background-color:#00ff00e6}.disactive[_ngcontent-%COMP%]{width:20px;height:20px;background-color:#ff0000e6}form[_ngcontent-%COMP%]{width:70%;margin:auto}@media only screen and (max-width: 993px){bottom[_ngcontent-%COMP%]{margin:5px}form[_ngcontent-%COMP%]{width:90%}}"]}),e})()},{path:"Add",component:C}];let X=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[f.Bz.forChild(V),f.Bz]}),e})();var tt=a(3870),et=a(2575),ot=a(259);let st=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[m.ez,X,tt.q,r.u5,r.UX,et.I,ot.m]}),e})()}}]);